<!-- TODO: Model-ize all the templates! -->
<!DOCTYPE html>
<html>
<head>
		<link href="{{ url_for('static', filename='css/google_material_icons.css') }}" rel="stylesheet">
		<link type="text/css" rel="stylesheet" href="{{ url_for('static', filename='css/materialize.css') }}"  media="screen,projection"/>
		<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
		<title>HR系统_demo</title>
		<meta name="theme-color" content="#33691E">

        <!-- //Should localize necessary Javascript libraries -->
		<script type="text/javascript" src="{{ url_for('static', filename='js/jquery-2.1.1.min.js') }}"></script>
		<script type="text/javascript" src="{{ url_for('static', filename='js/materialize.min.js') }}"></script>

</head>

<body>
    <input type="hidden" value="0" id="refresh-flag">

    <!-- [PUBLIC ZONE] PAGE HEADER -->
		<header>
            <div class="navbar-fixed">
                <nav>
                    <div class="nav-wrapper light-green darken-4">
                        <!-- Header title link should redirect to the home page -->
                        <a href="{{ url_for('personal') }}" class="brand-logo" title="点击返回主页面"><img src="" style="width:1em; height:1em;" alt="something to fill in"/>HR系统_demo</a>
                        {% if 'id' in session %}
                            <!-- Log-out Switcher
                                The following part will only be seen after logging in
                            -->
                            <ul id="out" class="dropdown-content">
                                <li><a href="#!">手滑了....</a></li>
                                <li><a href="{{ url_for('logout') }}">确认登出</a></li>
                            </ul>
                            <ul class="right">
                                <li>
                                    <a class="dropdown-button" href="#!" data-activates="out" title="注销登录">登出</a>
                                </li>
                            </ul>

                            <!-- Username Indicator -->
                            <ul class="right hide-on-small-only">
                                <li>
                                    <a class="dropdown-button">{{ session['id'] }}</a>
                                </li>
                            </ul>
                        {% endif %}
                    </div>
                </nav>
            </div>

            <!-- primitive version -->
			<!--div class="light-green darken-4 z-depth-2">
				<div class="container">
					<br>
					<h3 class="header center-on-small-only white-text">HR系统_demo</h3>
					<br>
				</div>
			</div-->
        </header>

    <!-- Page Body -->
        <main>
            {% block main_content %}
            {% endblock %}
        </main>
<!-- TODO: 显示完消息之后，若用后退或前进进行导航，则同样的Flash消息还会再次出现 -->
    <!-- Flash Notification Controller based on Materialize Toaster -->
    <!-- Use the theme from Toastr -->
    <link rel="stylesheet" href="{{ url_for('static', filename='css/toastr.css') }}">
    <script id="notification-controller">
        $(document).ready(function() {
            var showFlashToast = function () {
                //alert("Shown");
                var refresh_flag = document.getElementById("refresh-flag");
                if (refresh_flag.value == "0") {
                    refresh_flag.value = "1";

                    {% for msg in get_flashed_messages(with_categories=true) %}
                        var message = {
														// TODO: |safe 标签不管用
                            text: "{{ msg[1] }}".replace("&lt;", "<").replace("&gt;", ">"),
                            category: "{{ msg[0] }}"
                        };
                        var $messageHTML = $("<div>" + message.text + "</div>");
                        switch (message.category) {
                            case "error":
                                Materialize.toast($messageHTML, 4000, "toast-error");
                                break;
                            case "success":
                                Materialize.toast($messageHTML, 3000, "toast-success");
                                break;
                            default:
                                Materialize.toast($messageHTML, 3000, "toast-info");
                        }

                    {% endfor %}
                }
                else{
                    location.reload();
                }
            };

            $("body").bind("onload", showFlashToast())
        })
    </script>

</body>

</html>
